<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password | RentoVerse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html, body { height: 100%; }
        body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans"; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-100 via-sky-100 to-purple-100 flex items-center justify-center px-4 pt-16">

<!-- Top Navbar (same look as login page) -->
<header class="fixed inset-x-0 top-0 z-50 bg-blue-500 text-white shadow-md ring-1 ring-pink-700/20">

    <nav class="mx-auto max-w-6xl px-4">
        <div class="flex h-14 items-center justify-between">
            <!-- Left: Home -->
            <a href="/index.html" class="inline-flex items-center gap-2 font-bold hover:text-indigo-200 transition">
                <img src="https://img.icons8.com/fluency/48/home.png" alt="Home" class="w-5 h-5"/>
                <span>Home</span>
            </a>

            <!-- Center: navigation links -->
            <ul class="hidden md:flex items-center gap-6 text-sm font-medium">
                <li><a href="/all-available-rooms.html" class="hover:text-indigo-200 transition">Rooms</a></li>
                <li><a href="/all-posted-rooms.html" class="hover:text-indigo-200 transition">Post Room</a></li>
                <li><a href="/support.html" class="hover:text-indigo-200 transition">Support Ticket</a></li>
            </ul>

            <!-- Right: auth buttons -->
            <div class="flex items-center gap-2">
                <a href="/login.html"class="rounded-lg bg-gradient-to-r from-indigo-600 to-green-500 px-3.5 py-1.5 text-sm font-semibold text-white hover:from-green-500 hover:to-green-400 transition">Log in</a>
                <a href="/register.html" class="rounded-lg bg-gradient-to-r from-indigo-600 to-green-500 px-3.5 py-1.5 text-sm font-semibold text-white hover:from-green-500 hover:to-green-400 transition">Register</a>
            </div>
        </div>
    </nav>
</header>

<!-- centered a bit lower to match look #2 -->
<main class="w-full max-w-md mt-12 md:mt-16 lg:mt-20">
    <!-- SIMPLE BOX like screenshot #2: no outer gradient, soft ring + shadow -->
    <section class="rounded-2xl bg-white/95 shadow-xl ring-1 ring-slate-200 p-8">
        <!-- Brand -->
        <a href="/index.html" class="mx-auto mt-2 mb-6 flex w-max items-center gap-2">
            <img src="https://img.icons8.com/fluency/48/home.png" alt="Logo" class="w-6 h-6" />
            <span class="text-lg font-extrabold tracking-tight" style="color:#1E56E5">RentoVerse</span>
        </a>

        <h1 class="text-2xl font-extrabold text-center text-slate-900">Forgot your password?</h1>
        <p class="mt-2 text-center text-slate-600">We'll send a 6-digit code to your email and let you set a new password.</p>

        <!-- Step 1: send code -->
        <form id="sendCodeForm" class="mt-6 space-y-5">
            <div>
                <label for="fpEmail" class="block text-sm font-medium text-slate-700">Email</label>
                <input id="fpEmail" type="email" required class="mt-1 w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-slate-900 placeholder-slate-400 shadow-sm outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20" placeholder="you@example.com" />
            </div>
            <button id="sendBtn" type="submit" class="inline-flex w-full items-center justify-center rounded-lg bg-indigo-600 px-4 py-2.5 font-semibold text-white shadow-sm transition hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500/30">Send code</button>
        </form>

        <!-- Step 2: verify & reset -->
        <form id="resetForm" class="mt-6 space-y-5 hidden">
            <div>
                <label for="fpCode" class="block text-sm font-medium text-slate-700">Verification code</label>
                <input id="fpCode" inputmode="numeric" maxlength="6" required class="mt-1 w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-slate-900 placeholder-slate-400 shadow-sm outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20" placeholder="6-digit code" />
            </div>
            <div>
                <div class="flex items-center justify-between">
                    <label for="newPwd" class="block text-sm font-medium text-slate-700">New password</label>
                    <button type="button" id="toggleNew" class="text-xs font-medium text-slate-600 hover:text-slate-900">Show</button>
                </div>
                <div class="relative mt-1">
                    <input id="newPwd" type="password" required class="w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 pr-12 text-slate-900 placeholder-slate-400 shadow-sm outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20" />
                    <button type="button" id="eyeNew" class="absolute right-2.5 top-1/2 -translate-y-1/2 p-2 rounded-md hover:bg-slate-100" aria-label="Toggle password">
                        <svg id="iconNew" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5 text-slate-500"><path fill="currentColor" d="M12 5c-5 0-9.27 3.11-10.77 7.5C2.73 16.89 7 20 12 20s9.27-3.11 10.77-7.5C21.27 8.11 17 5 12 5Zm0 12a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9Z"/></svg>
                    </button>
                </div>
            </div>
            <div>
                <div class="flex items-center justify-between">
                    <label for="confirmPwd" class="block text-sm font-medium text-slate-700">Confirm password</label>
                    <button type="button" id="toggleConfirm" class="text-xs font-medium text-slate-600 hover:text-slate-900">Show</button>
                </div>
                <div class="relative mt-1">
                    <input id="confirmPwd" type="password" required class="w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 pr-12 text-slate-900 placeholder-slate-400 shadow-sm outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20" />
                    <button type="button" id="eyeConfirm" class="absolute right-2.5 top-1/2 -translate-y-1/2 p-2 rounded-md hover:bg-slate-100" aria-label="Toggle password">
                        <svg id="iconConfirm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5 text-slate-500"><path fill="currentColor" d="M12 5c-5 0-9.27 3.11-10.77 7.5C2.73 16.89 7 20 12 20s9.27-3.11 10.77-7.5C21.27 8.11 17 5 12 5Zm0 12a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9Z"/></svg>
                    </button>
                </div>
            </div>

            <!-- light, clean button -->
            <button id="resetBtn" type="submit" class="inline-flex w-full items-center justify-center rounded-lg bg-indigo-600 px-4 py-2.5 font-semibold text-white shadow-sm transition hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500/30">
                Reset password
            </button>
        </form>

        <p id="fpMessage" class="mt-4 text-center text-sm font-medium"></p>

        <p class="text-center text-sm text-slate-600 mt-6">
            Remember your password? <a href="/login.html" class="text-indigo-700 font-medium hover:text-indigo-900">Back to login</a>
        </p>
    </section>
</main>

<script>
    const msg = document.getElementById('fpMessage');

    // Step 1: send code
    document.getElementById('sendCodeForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('fpEmail').value.trim();
        msg.textContent = 'Sending code…';
        msg.className = 'mt-4 text-center text-sm font-medium text-slate-600';

        try {
            const res = await fetch(`/api/auth/forgot-password?email=${encodeURIComponent(email)}`, { method: 'POST' });
            if (!res.ok) {
                // try read JSON and pick a clean message
                let clean = 'Could not send code';
                try {
                    const data = await res.json();
                    clean = data?.message || data?.error || clean;
                } catch {
                    const text = await res.text();
                    // pull only the message if JSON string came as text
                    const m = /\"message\":\"([^"]+)\"/.exec(text);
                    clean = m ? m[1] : clean;
                }
                throw new Error(clean);
            }

            msg.textContent = 'Code sent! Check your email.';
            msg.className = 'mt-4 text-center text-sm font-medium text-emerald-600';
            document.getElementById('resetForm').classList.remove('hidden');
        } catch (err) {
            // example: “No user for this email”
            msg.textContent = String(err.message || 'Failed to send code');
            msg.className = 'mt-4 text-center text-sm font-medium text-rose-600';
        }
    });


    function bindToggle(textBtnId, eyeBtnId, inputId, iconId) {
        const textBtn = document.getElementById(textBtnId);
        const eyeBtn = document.getElementById(eyeBtnId);
        const input = document.getElementById(inputId);
        const icon = document.getElementById(iconId);
        function setIcon(open) {
            icon.innerHTML = open
                ? '<path fill="currentColor" d="M12 5c-5 0-9.27 3.11-10.77 7.5C2.73 16.89 7 20 12 20s9.27-3.11 10.77-7.5C21.27 8.11 17 5 12 5Zm0 12a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9Z"/>'
                : '<path fill="currentColor" d="M3.53 2.47 2.47 3.53 6.2 7.26C3.95 8.55 2.29 10.34 1.23 12.5 2.73 16.89 7 20 12 20c2.26 0 4.36-.6 6.14-1.64l 3.33 3.33 1.06-1.06L3.53 2.47ZM12 7a5 5 0 0 1 5 5c0 .54-.09 1.05-.25 1.53l-6.28-6.28C11 7.09 11.49 7 12 7Z"/>';
        }
        function toggle() {
            const toText = input.type === 'password';
            input.type = toText ? 'text' : 'password';
            if (textBtn) textBtn.textContent = toText ? 'Hide' : 'Show';
            setIcon(!toText);
        }
        textBtn?.addEventListener('click', toggle);
        eyeBtn?.addEventListener('click', toggle);
    }
    bindToggle('toggleNew','eyeNew','newPwd','iconNew');
    bindToggle('toggleConfirm','eyeConfirm','confirmPwd','iconConfirm');

    // Step 2: reset password
    document.getElementById('resetForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('fpEmail').value.trim();
        const code = document.getElementById('fpCode').value.trim();
        const newPwd = document.getElementById('newPwd').value;
        const confirm = document.getElementById('confirmPwd').value;
        if (newPwd !== confirm) {
            msg.textContent = 'Passwords do not match.'; msg.className = 'mt-4 text-center text-sm font-medium text-rose-600';
            return;
        }
        msg.textContent = 'Resetting…'; msg.className = 'mt-4 text-center text-sm font-medium text-slate-600';
        try {
            const res = await fetch('/api/auth/reset-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, code, newPassword: newPwd })
            });
            if (!res.ok) throw new Error(await res.text());
            msg.textContent = 'Password reset successful! You can log in now.'; msg.className = 'mt-4 text-center text-sm font-medium text-emerald-600';
        } catch (err) {
            msg.textContent = 'Failed to reset: ' + (err.message || 'Error'); msg.className = 'mt-4 text-center text-sm font-medium text-rose-600';
        }
    });
</script>
</body>
</html>